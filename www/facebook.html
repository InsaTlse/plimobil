<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>App Insa Alpha 1</title>		
		<meta name="viewport" content="width=device-width, user-scalable=no" />
		
		<link rel="stylesheet" href="js/jquery.mobile-1.4.1.css" />
		<link rel="stylesheet" href="css/custom.css" />
		<!--<script src="js/index.js"></script>-->	
		<script src="cordova.js"></script>
		<script src="js/jquery-1.11.0.min.js"></script>
		<script src="js/jquery.mobile-1.4.1.min.js"></script>
	
		<!--<script src="cordova_plugins.js"></script>-->
		<script>
			$.support.cors = true;
			$.mobile.allowCrossDomainPages = true;
			$.mobile.phonegapNavigationEnable = true;
			
			
		</script>
		
	</head>
	<body>
		<div data-role="page" id="facebook_page" data-theme="b" data-dom-cache="true">
			
			<header data-role="header" data-position="fixed" style="background-color:#3B5998">
				<a href="index.html" data-icon="home" data-role="button" data-iconpos="notext" class="big-btn ui-nodisc-icon" data-corners="false" data-transition="pop" data-direction="reverse">Retour</a>
				<h1 >Facebook</h1>
				<a href="#right-panel" data-icon="bars" data-iconpos="notext" class="big-btn ui-nodisc-icon" data-corners="false">Menu</a>
			</header>
			
			<section data-role="content" >
			
				<p style="text-align:center" id="loader" ><img  src="js/images/ajax-loader.gif" /></p>
				<p id="error_message" style="text-align:center;display:none;"></p>
				<ul data-role="listview" id="fb-feed"></ul>
			
			</section>
			
			<footer data-role="footer" data-position="fixed" data-tap-toggle="false">
				<div data-role="navbar">
					<ul>
					
						<li><a href="tweets.html" class="ui-nodisc-icon no-radius big-icon" data-ajax="false"><img  height="48" src="img/icons/twitter_blue.svg"></a></li>
						<li><a href="#" onclick="navigator.app.loadUrl('http://www.youtube.com/user/InsaToulouse',{ openExternal:true })" class="ui-nodisc-icon no-radius big-icon"  ><img  height="48" src="img/icons/youtube_logo.svg"></a></li>
						<!--<li><a href="#" onclick="navigator.app.loadUrl('http://www.linkedin.com/groups/INSA-de-Toulouse-1853952?trk=myg_ugrp_ovr',{ openExternal:true })" class="ui-nodisc-icon no-radius big-icon" data-icon="linkedin"></a></li>
						<li><a href="#" onclick="navigator.app.loadUrl('http://www.viadeo.com/groups/?containerId=0021q19whauziley',{ openExternal:true })" class="ui-nodisc-icon no-radius big-icon" data-icon="viadeo"></a></li>
					-->
					</ul>
				</div><!-- /navbar -->
			
			</footer>
			<!-- /panel -->
			<div data-role="panel" id="right-panel" data-position-fixed="true" data-position="right" data-display="overlay" data-theme="b">
				<div class="ui-panel-inner">	
					<ul data-role="listview" style="z-index=-100" >
						<li data-role="list-divider">Aller à la rubrique..</li>
						<li data-icon="home"><a href="index.html" data-transition="pop" data-direction="reverse">Accueil</a></li>
						<li data-icon="bullets"><a href="pres.html" data-transition="flow">Présentation</a></li>
						<li data-icon="rss"><a href="actu.html" data-ajax="false">Actu</a></li>
						<li data-icon="calendar"><a href="edt.html" data-transition="flow">Emploi du Temps</a></li>
						<li data-icon="cloud"><a href="meteo.html" data-transition="flow">Météo</a></li>
						<li data-icon="cutlery"><a href="ru.html" data-transition="flow">Menu Self</a></li>
						<li data-icon="twitter"><a href="tweets.html" data-transition="flow">Réseaux Sociaux</a></li>
						<li data-icon="location"><a href="plan.html" data-transition="flow">Plan d'accès</a></li>
						<li data-icon="book"><a href="bib.html" data-transition="flow">BIB in Sports</a></li>
						<li data-icon="wifi"><a href="wifi.html" data-transition="flow">Configurer Wifi</a></li>
						<li data-icon="phone"><a href="contact.html" data-transition="flow">Contact</a></li>
					</ul>
				</div>
			</div>
		<script>
			$(document).one('pagecreate', '#facebook_page', function() {
				
				//$.get('http://127.0.0.1/fb.xml', function(data){
				$.get('https://www.facebook.com/feeds/page.php?format=atom10&id=165299990160169', function(data){
					var i = 1;
										
					$(data).find('entry').each(function(){
						
						//if(i>5)return false;
						
						//création du sommaire
						var article = $(this);
						//alert(article.text());
						var titre = article.find('title').text();
						
						var description = article.find('content').text();
						var img = $('<div>'+description+'</div>').find('img').attr('src');
							
						if(!img) img = $('<div>'+description+'</div>').find('a').attr("href");
						//alert('4');	
						//if(!img) img = $(description).filter('a').text();
						
						
					
						
						
						var url = article.find('link').attr('href');
						
						var date = article.find('updated').text();
						
						var dateArr = date.split('T');
						var day = dateArr[0].split('-');
						var hour = dateArr[1].split('+');
						if(!img) img = 'js/images/ajax-loader.gif';
					
						var content = '<li><a href="#" onclick="navigator.app.loadUrl(\''+url+'\',{ openExternal:true })" rel="external" ><img src="'+img+'" /><h2>'+titre+'</h2><p><small>le '+day[2]+'-'+day[1]+'-'+day[0]+' à '+hour[0]+'</small> </p></a></li>';
						
						$("#facebook_page #loader").hide();
						//contenu comple de la page
						/*var newPage = '<div style="display:none" class="fb_content"><h2>'+titre+'</h2><p><p><small>le '+day[2]+'-'+day[1]+'-'+day[0]+' à '+hour[0]+'</small></p><p>'+description+'</p><p style="clear:both;text-align:right;margin-top:10px"><a style="text-decoration:none" href="#" onclick="navigator.app.loadUrl(\''+url+'\',{ openExternal:true })" rel="external" >&raquo; Voir sur le site Internet</a></p></div>';*/
						$('#fb-feed').append(content);
						//$('#fb-feed').append(content);
						

						i++;
					});
					//$.mobile.loading('hide');
					$('#fb-feed').listview('refresh');
					
					
					
				}).fail(function(){
					$("#facebook_page #loader").hide();
					$('#facebook_page #error_message').html('Erreur de chargement du flux Facebook').show();
				});
				
				/*$( "#facebook_page" ).on( "swipeleft", function() {
					
						// We check if there is no open panel on the page because otherwise
						// a swipe to close the left panel would also open the right panel (and v.v.).
						// We do this by checking the data that the framework stores on the page element (panel: open).
						if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
							
								$( "#right-panel" ).panel( "open" );
							
						}
				});	*/
				
			});
		</script>
		

		</div>
		
	</body>
</html>
